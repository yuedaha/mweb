# dubbo 知识体系梳理

## Dubbo 和 Spring Cloud 区别
* dubbo 是一个 rpc 的框架，用作于服务治理的，它里面内置了一些服务治理相关的支持，例如注册中心、负载熔断技术，但是不完善，服务网关、服务跟踪等都没有，需要自己引入其他中间件或者自己开发
* Spring Cloud 是一整套微服务的解决方案，从注册中心，到服务治理，包括服务的跟踪、监控等等
* dubbo 是基于服务与服务之间的接口调用， Spring Cloud 是基于 http 的调用

## dubbo 工作原理
dubbo 是一个 rpc 的框架，解决了分布式系统里面不同系统之间的服务调用问题。服务提供者提供一套 api 接口，服务调用者依赖 api 接口，在代码中直接可以像本地接口一下调用。
* dubbo服务在启动时，根据服务提供者的 api 接口和实现，生成一个代理实例
* 启动一个服务，并且将服务接口的地址注册到注册中心
* dubbo客户端服务启动后，去订阅注册中心，根据消费者需要消费的接口生成一个代理实例
* 当消费者进行接口调用时，通过代理实例，通过负载均和的算法，发起远程调用
* 当dubbo的服务端收到远程调用后，找到对应接口的代理实例，执行对应方法，得到结果后序列化返回
* dubbo客户端的代理实例，接受结果，并且反序列化得到对象，返回给消费者

## dubbo 通讯协议
dubbo 通讯协议如下：
* dubbo 协议（默认）
    * 单一长连接的协议
    * 采用 NIO 异步通讯
    * 使用 hessian 序列化协议
    * 适用于生产者少，消费者多的情况；传输数据量小，但并发量高的情况
* rmi 协议
    * 短连接的协议
    * 使用 java 二进制序列化
    * 适合生产者和消费者差不多情况下；一般用于文件传输
* hessian 协议
    * 短连接的协议
    * 使用 hessian 序列化协议
    * 适用于生产者比消费者还多的情况下；一般用于文件传输
* http 协议
    * 走 json 序列化
* webservice 协议
    * 走 SOAP 文本序列化

## dubbo 负载均衡策略
* 加权随机
* 加权轮询
* 最少活跃
* 一致性hash

## dubbo 容错机制
* failover cluster 模式（默认）
    * 失败自动切换，重试其他机器
    * 常用于读操作
* failfast cluster 模式
    * 一次调用失败，立即返回
    * 常用于写操作
* failsafe cluster 模式
    * 出现异常后会被忽略
    * 常用于不同要的接口调用，例如日志操作
* failback cluster 模式
    * 失败了后台自动记录，定时重发，
    * 比较适合写消息队列
* forking cluster 模式
    * 并行调用多个 provider，只要有一个成功，就算成功
* broadcast cluster 模式
    * 逐个调用所有的 provider

dubbo 的 SPI 机制