# 项目问题

## 如何对现有系统优化
* 基础层面
    * 存储：服务器可以采用SSD来做持久存储、采用分布式存储方式（易于扩容和灾备）
    * 服务器：采用云主机的方式，易于扩容和弹性增缩
    * 网络：采用CDN的流量分发
* 数据库
    * 可以按照CDN方式做分库分表
    * 针对单个库多读写分离
* 应用层
    * 首先测算出一定配置下的系统的最大负载能力（压测）
    * 根据流量，做合理的横向服务器部署
    * 进入后台服务，一定要做好合理负载均衡，确保服务流量均衡
    * 如果出现流量洪峰，可以加入MQ服务，由服务慢慢处理
    * 静态资源尽量采用缓存
* 服务治理和运维
    * 做好流量监控和服务追踪，当流量超过预警线，要通知运维人员，做服务降级或者弹性扩容，如果某些节点出现大量请求缓慢，应及时采用熔断机制
    * 如果出现流量洪峰，为了保证服务的高可用，可以暂时关闭一些边缘服务，减少带宽占用
    * 通过采用一些运维工具，辅助客服和运维人员，及时发现问题，追踪问题根源，持续集成解决
* 架构方面
    * 尽可能采用微服务的思想，将服务拆分，服务分层，将公共服务拆分出去，降低服务的复杂度
    * 事务方面，尽量避免强一致性事务，做到高可用，采用最终一致性事务
    * 持续对代码进行重构，根据线上运行情况，不断的演练服务自己业务的框架


## 项目中遇到的技术难点

难点：在开发家长满意度调查的时候，针对答卷要做分析报告的导出，就是数据的图表展示。所以模板写死，图片数据和表格数据写死。后来，学校试用之后，都想要自己的个性化的图片和表格。

技术：
* github开源poi框架，作为word模板
* phantomjs + echart，后台生成图片

解决方案：
1、动态SQL拼接，通过配置，将word模板中的每个图片和表格所涉及的数据库表和字段，还有一些操作，包括求和，求平均值等，都通过配置文件来读取，动态拼接SQL。这解决了个性化的图表问题，但是还有一个问题就是如何在不重启服务情况下，动态完成增加和修改配置文件，之后我用了zk来存储这些配置文件，通过监听来动态的替换配置缓存。
2、word模板开发了一个上传的功能
3、然后导出就可以完成个性化的导出
